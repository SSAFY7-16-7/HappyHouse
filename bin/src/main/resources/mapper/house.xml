<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.happyhouse.model.dao.HouseDao">

	<resultMap id="houseInfo" type="HouseInfo">
		<result column="aptCode" property="aptCode"/>
		<result column="aptName" property="aptName"/>
		<result column="dongName" property="dongName"/>
	</resultMap>

	<resultMap id="houseList" type="HouseDeal">
		<result column="aptCode" property="articleNo"/>
		<result column="dealAmount" property="dealAmount"/>
		<result column="dealYear" property="dealYear"/>
		<result column="dealMonth" property="dealMonth"/>
		<result column="dealDay" property="dealDay"/>
		<collection property="houseInfo" resultMap="HouseInfo" />
	</resultMap>
	
	<sql id="searchCond">
		<if test="word != null and word !=''">
			<choose>
				<when test="key == 'name'">
					aptName like concat('%',#{word},'%')
				</when>
				<when test="key == 'dong'">
					dongName = #{word}
				</when>
			</choose>
		</if>
	</sql>


	<select id="getList" parameterType="PageBean" resultMap="houseList">
		select i.aptCode, i.aptName, d.dealAmount, d.dealYear, d.dealMonth, d.dealDay
		from housedeal d, houseinfo i
		<where>
			d.aptCode = i.aptCode
			<include refid="searchCond"/>
		</where>
	</select>
	
	<select id="count" parameterType="PageBean" resultType="int">
		select count(*) as cnt from notebook
		<where>
			<include refid="searchcond"/>
		</where>
	</select>
	
	
</mapper>