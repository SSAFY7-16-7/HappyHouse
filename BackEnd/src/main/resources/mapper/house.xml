<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.happyhouse.model.dao.HouseDao">
	<sql id="searchCond">
		<if test="word != null and word !=''">
			<choose>
				<when test="key == 'name'">
					and apartmentName like concat('%',#{word},'%')
				</when>
				<when test="key == 'dong'">
					and dongName = #{word}
				</when>
			</choose>
		</if>
	</sql>


	<select id="getList" parameterType="PageBean" resultType="HouseInfoDeal">
		select i.aptCode, i.apartmentName, i.dong, i.jibun,i.lat,i.lng, d.area, d.floor, d.dealAmount, d.dealYear, d.dealMonth, d.dealDay
		from housedeal d, houseinfo i
		<where>
			d.aptCode = i.aptCode
			<include refid="searchCond"/>
		</where>
		limit #{start},#{interval}
	</select>
	
	<select id="count" parameterType="PageBean" resultType="int">
		select count(*) as cnt
		from housedeal d, houseinfo i
		<where>
			d.aptCode = i.aptCode
			<include refid="searchCond"/>
		</where>
	</select>
	
	<select id="countAll" resultType="int">
		select count(*) as cnt
		from housedeal d, houseinfo i
		<where>
			d.aptCode = i.aptCode
		</where>
	</select>
</mapper>